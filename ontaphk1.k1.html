<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn tập Tin học 1 - Cuối kì 1</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Roboto:wght@400;500;700&family=Source+Code+Pro:wght@600&display=swap" rel="stylesheet">

    <style>
        /* --- COPY STYLE TỪ INDEX.HTML --- */
        :root {
            --primary-color: #0056b3; 
            --accent-color: #00a8ff; 
            --bg-color: #f4f7f6;
            --text-color: #333;
            --card-bg: #ffffff;
            
            /* Giữ lại biến màu của bài trắc nghiệm cũ để không vỡ giao diện câu hỏi */
            --primary: #009688; 
            --secondary: #ff9800; 
            --bg: #e0f2f1; 
            --text: #333; 
            --correct: #c8e6c9; 
            --wrong: #ffcdd2;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-color); color: var(--text-color); padding-bottom: 80px; }

        /* --- HEADER STYLE (GIỐNG INDEX.HTML) --- */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-bottom: 5px solid #ffcc00;
            position: sticky; top: 0; z-index: 100; /* Giữ sticky để tiện theo dõi */
        }

        .header-left h1 {
            font-family: 'Source Code Pro', monospace;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .header-left h2 { font-size: 1rem; font-weight: 400; opacity: 0.9; }

        .header-right {
            text-align: right;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .teacher-name { font-size: 1rem; font-weight: bold; color: #fff; }
        
        /* Style riêng cho thông tin học sinh hiển thị trên header */
        .student-info-display { color: #ffeb3b; font-weight: bold; margin-top: 5px; font-size: 1.1rem; border-top: 1px dashed rgba(255,255,255,0.3); padding-top: 5px; }

        /* --- FOOTER STYLE (GIỐNG INDEX.HTML) --- */
        footer {
            text-align: center; padding: 20px; margin-top: 50px;
            color: #777; font-size: 0.9rem; border-top: 1px solid #ddd;
            background-color: white;
        }

        /* --- STYLE CHO PHẦN TRẮC NGHIỆM (GIỮ NGUYÊN) --- */
        #loginScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 86, 179, 0.98); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .login-box { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { font-weight: bold; display: block; margin-bottom: 5px; color: #333; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; outline: none; }
        .btn-start { background: var(--secondary); color: white; border: none; padding: 12px 40px; border-radius: 30px; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%; }
        
        .container { max-width: 800px; margin: 40px auto; padding: 0 15px; display: none; }
        .question-card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-bottom: 5px solid #ccc; page-break-inside: avoid; }
        .q-header { display: flex; align-items: flex-start; margin-bottom: 15px; }
        .q-number { background: var(--primary-color); color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-right: 15px; flex-shrink: 0; }
        .q-text { font-size: 1.1rem; font-weight: 600; line-height: 1.4; }

        .answers-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
        .answer-opt { display: flex; align-items: center; padding: 12px; border: 2px solid #eee; border-radius: 12px; cursor: pointer; transition: all 0.2s; background: #fafafa; }
        .answer-opt:hover { border-color: var(--primary-color); background: #e0f2f1; }
        .answer-opt input { margin-right: 10px; transform: scale(1.3); accent-color: var(--primary-color); flex-shrink: 0; }
        .ans-icon { font-size: 1.2rem; margin-right: 8px; color: #555; width: 25px; text-align: center; }
        .ans-text { font-weight: 500; }

        .correct { background-color: var(--correct) !important; border-color: #4caf50 !important; color: #1b5e20; }
        .wrong { background-color: var(--wrong) !important; border-color: #f44336 !important; color: #b71c1c; opacity: 0.8; }
        .unanswered { border: 2px solid red; animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        .footer-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); display: flex; justify-content: center; gap: 20px; z-index: 1000; display: none; }
        .btn-submit { background: var(--primary-color); color: white; border: none; padding: 12px 30px; border-radius: 30px; font-weight: bold; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
        .btn-submit:hover { background: #004494; transform: translateY(-3px); }
        
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 3000; flex-direction: column; color: white; }
        .spinner { border: 6px solid #f3f3f3; border-top: 6px solid var(--secondary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .result-box { background: white; color: #333; padding: 30px; border-radius: 20px; text-align: center; width: 90%; max-width: 400px; animation: popUp 0.3s ease; }
        .score-circle { width: 100px; height: 100px; background: var(--primary-color); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2rem; font-weight: bold; margin: 20px auto; }
        #pdf-header-info { display: none; text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            header { flex-direction: column; text-align: center; gap: 15px; }
            .header-right { text-align: center; width: 100%; }
        }
    </style>
</head>
<body>

    <div id="loginScreen">
        <div class="login-box">
            <i class="fas fa-robot" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 15px;"></i>
            <h2 style="color: var(--primary-color); margin-bottom: 20px;">ÔN TẬP HỌC TIN 1</h2>
            <div class="input-group"><label>Họ và tên:</label><input type="text" id="sName" placeholder="Nhập tên..."></div>
            <div class="input-group"><label>Lớp:</label><input type="text" id="sClass" placeholder="Ví dụ: 1A"></div>
            <button class="btn-start" onclick="startQuiz()">BẮT ĐẦU</button>
        </div>
    </div>

    <header id="mainHeader" style="display: none;">
        <div class="header-left">
            <h1><i class="fas fa-laptop-code"></i> TIN HỌC 1</h1>
            <h2>Bộ sách: Luyện tập Tin học</h2>
        </div>
        <div class="header-right">
            <div class="teacher-name">GV - Nguyễn Đình Bạch Long</div>
            <div class="student-info-display" id="displayInfo"></div>
        </div>
    </header>

    <div style="text-align: center; margin-top: 20px; display: none;" id="backButtonArea">
        <a href="../index.html" style="text-decoration: none; color: #666;"><i class="fas fa-arrow-left"></i> Quay lại trang chủ</a>
    </div>

    <div id="pdf-area">
        <div id="pdf-header-info">
            <h1 style="color: var(--primary-color);">KẾT QUẢ ÔN TẬP CUỐI KÌ 1</h1>
            <h3 id="pdf-name"></h3>
            <h2 id="pdf-score" style="color: red;"></h2>
        </div>
        <div class="container" id="quizContainer"></div>
    </div>

    <footer id="mainFooter" style="display: none;">
        &copy; 2025 - Website hỗ trợ học tập Tin học 1 | GV Nguyễn Đình Bạch Long
        <div>Email: dinhlongcntt20119@gmail.com  |  SĐT: 0937438939</div>
        <div>STK: 0937438939  |  Ngân hàng: Vietinbank</div>
    </footer>

    <div class="footer-bar" id="footerBar">
        <button class="btn-submit" onclick="submitExam()"><i class="fas fa-paper-plane"></i> NỘP BÀI & LƯU DRIVE</button>
    </div>

    <div id="loadingOverlay" class="overlay">
        <div class="spinner"></div>
        <h3>Đang nộp bài...</h3>
        <p>Hệ thống đang lưu gửi bài cho giáo viên</p>
    </div>

    <div id="resultModal" class="overlay">
        <div class="result-box">
            <h2 style="color: var(--primary-color);">Hoàn thành!</h2>
            <div class="score-circle" id="scoreDisplay">0/30</div>
            <p id="msg" style="font-weight: bold; margin-bottom: 10px;"></p>
            <div id="driveMsg" style="background: #eee; padding: 10px; border-radius: 8px; font-size: 0.85rem;"></div>
            <button class="btn-start" style="margin-top: 15px; background: #757575;" onclick="location.reload()">Làm lại</button>
            <a href="../index.html" class="btn-start" style="margin-top: 10px; background: var(--primary-color); display: inline-block; text-decoration: none; padding: 12px 0;">Về trang chủ</a>
        </div>
    </div>

    <script>
        // --- ⚠️ THAY URL SCRIPT CỦA BẠN VÀO ĐÂY SAU KHI DEPLOY ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyNfaBH5mDRDyUbwXgexVCT52w1laD5BQP7H5nvmePW1tQKzYbrkByBLnWu1rCr9PTK/exec"
        let student = { name: "", class: "" };

        // --- CẤU HÌNH CÂU HỎI (GIỮ NGUYÊN) ---
        // Lưu ý: Các câu 3,6,7,8,9,10,11,12,14,15,21,24 đã xóa thuộc tính 'i' (icon)
        const questions = [
            // CÂU 1
            {
                q: "Câu 1: Bộ phận nào được ví như 'bộ não' của máy tính?",
                a: [{ t: "Màn hình", i: "fa-desktop" }, { t: "Thùng điều khiển (CPU)", i: "fa-server" }, { t: "Bàn phím", i: "fa-keyboard" }],
                c: 1
            },
            // CÂU 2
            {
                q: "Câu 2: Thiết bị nào giúp em gõ chữ cái và số vào máy tính?",
                a: [{ t: "Chuột", i: "fa-mouse" }, { t: "Bàn phím", i: "fa-keyboard" }, { t: "Loa", i: "fa-volume-up" }],
                c: 1
            },
            // CÂU 3 (Bỏ icon)
            {
                q: "Câu 3: Chuột máy tính thông thường có mấy nút bấm chính?",
                a: [{ t: "1 nút" }, { t: "2 nút (Trái, Phải)" }, { t: "5 nút" }],
                c: 1
            },
            // CÂU 4
            {
                q: "Câu 4: Để nghe nhạc từ máy tính mà không làm phiền người khác, em dùng gì?",
                a: [{ t: "Tai nghe", i: "fa-headphones" }, { t: "Loa ngoài", i: "fa-volume-up" }, { t: "Máy in", i: "fa-print" }],
                c: 0
            },
            // CÂU 5
            {
                q: "Câu 5: Máy tính xách tay (Laptop) có bộ phận nào thay thế chuột?",
                a: [{ t: "Vùng cảm ứng (Touchpad)", i: "fa-hand-pointer" }, { t: "Bàn phím", i: "fa-keyboard" }, { t: "Màn hình", i: "fa-desktop" }],
                c: 0
            },
            // CÂU 6 (Bỏ icon)
            {
                q: "Câu 6: Tư thế ngồi máy tính nào là đúng?",
                a: [{ t: "Ngồi cong lưng, cúi sát" }, { t: "Ngồi thẳng lưng, mắt ngang tầm màn hình" }, { t: "Nằm ra bàn" }],
                c: 1
            },
            // CÂU 7 (Bỏ icon)
            {
                q: "Câu 7: Khoảng cách từ mắt đến màn hình nên là bao nhiêu?",
                a: [{ t: "Rất gần (10cm)" }, { t: "Vừa phải (50-80cm)" }, { t: "Rất xa (2 mét)" }],
                c: 1
            },
            // CÂU 8 (Bỏ icon)
            {
                q: "Câu 8: Ánh sáng trong phòng khi dùng máy tính cần thế nào?",
                a: [{ t: "Tối om" }, { t: "Đủ sáng, không chói" }, { t: "Chiếu thẳng vào mắt" }],
                c: 1
            },
            // CÂU 9 (Bỏ icon)
            {
                q: "Câu 9: Ngón trỏ tay phải đặt lên nút nào của chuột?",
                a: [{ t: "Nút Trái" }, { t: "Nút Phải" }, { t: "Bánh lăn" }],
                c: 0
            },
            // CÂU 10 (Bỏ icon)
            {
                q: "Câu 10: Thao tác 'Nhấp đúp chuột' là nhấn nút trái mấy lần?",
                a: [{ t: "1 lần" }, { t: "2 lần liên tiếp nhanh" }, { t: "3 lần" }],
                c: 1
            },
            // CÂU 11 (Bỏ icon)
            {
                q: "Câu 11: Để mở một biểu tượng trên màn hình (ví dụ Game), em thường dùng thao tác gì?",
                a: [{ t: "Nhấp đúp chuột" }, { t: "Kéo thả chuột" }, { t: "Nhấp chuột phải" }],
                c: 0
            },
            // CÂU 12 (Bỏ icon)
            {
                q: "Câu 12: Phím dài nhất trên bàn phím tên là gì?",
                a: [{ t: "Phím Enter" }, { t: "Phím Cách (Space)" }, { t: "Phím Shift" }],
                c: 1
            },
            // CÂU 13 (Đổi icon "Xuống dòng" phù hợp hơn)
            {
                q: "Câu 13: Phím Enter dùng để làm gì?",
                a: [
                    { t: "Xóa chữ", i: "fa-backspace" },
                    { t: "Xuống dòng", i: "fa-arrow-down" }, // Đổi thành mũi tên xuống
                    { t: "Viết hoa", i: "fa-font" }
                ],
                c: 1
            },
            // CÂU 14 (Bỏ icon)
            {
                q: "Câu 14: Phím Backspace (mũi tên sang trái) dùng để làm gì?",
                a: [{ t: "Xóa chữ bên trái" }, { t: "Cách một khoảng" }, { t: "Viết số" }],
                c: 0
            },
            // CÂU 15 (Bỏ icon)
            {
                q: "Câu 15: Khu vực phím số thường nằm ở đâu trên bàn phím máy tính để bàn?",
                a: [{ t: "Bên trái" }, { t: "Bên phải" }, { t: "Ở giữa" }],
                c: 1
            },
            // CÂU 16 (Đổi icon phù hợp hơn cho các nút cửa sổ)
            {
                q: "Câu 16: Biểu tượng dấu X góc trên cửa sổ dùng để làm gì?",
                a: [
                    { t: "Phóng to", i: "fa-window-maximize" },
                    { t: "Thu nhỏ", i: "fa-window-minimize" },
                    { t: "Đóng (Thoát)", i: "fa-window-close" } // Đổi icon X
                ],
                c: 2
            },
            // CÂU 17
            {
                q: "Câu 17: Phần mềm Paint (hoặc Art) dùng để làm gì?",
                a: [{ t: "Vẽ tranh", i: "fa-palette" }, { t: "Soạn thảo văn bản", i: "fa-file-word" }, { t: "Nghe nhạc", i: "fa-music" }],
                c: 0
            },
            // CÂU 18 (Sửa chữ "vùng kín" thành "vùng khép kín")
            {
                q: "Câu 18: Công cụ 'Thùng sơn' trong phần mềm vẽ giúp em làm gì?",
                a: [
                    { t: "Vẽ nét thẳng", i: "fa-pencil-alt" },
                    { t: "Tô màu vùng khép kín", i: "fa-fill-drip" },
                    { t: "Tẩy xóa", i: "fa-eraser" }
                ],
                c: 1
            },
            // CÂU 19
            {
                q: "Câu 19: Để vẽ hình tròn, hình vuông, em chọn công cụ nào?",
                a: [{ t: "Công cụ Hình mẫu", i: "fa-shapes" }, { t: "Bút chì", i: "fa-pencil-alt" }, { t: "Cục tẩy", i: "fa-eraser" }],
                c: 0
            },
            // CÂU 20
            {
                q: "Câu 20: Khi vẽ sai, em dùng công cụ gì để sửa?",
                a: [{ t: "Bút chì", i: "fa-pencil-alt" }, { t: "Cục tẩy (Gôm)", i: "fa-eraser" }, { t: "Thùng sơn", i: "fa-fill-drip" }],
                c: 1
            },
            // CÂU 21 (Bỏ icon)
            {
                q: "Câu 21: Trong trò chơi Clickomania, em nhấp chuột vào đâu để ghi điểm?",
                a: [{ t: "Nhóm bóng cùng màu" }, { t: "Bất kỳ bóng nào" }, { t: "Khoảng trống" }],
                c: 0
            },
            // CÂU 22
            {
                q: "Câu 22: Biểu tượng trình duyệt web (Google Chrome) dùng để làm gì?",
                a: [{ t: "Vào mạng Internet", i: "fa-globe" }, { t: "Vẽ tranh", i: "fa-palette" }, { t: "Tắt máy", i: "fa-power-off" }],
                c: 0
            },
            // CÂU 23
            {
                q: "Câu 23: Nút 'Quay lại' (Mũi tên trái) trên trình duyệt dùng để làm gì?",
                a: [{ t: "Về trang trước đó", i: "fa-arrow-left" }, { t: "Đóng trình duyệt", i: "fa-times" }, { t: "Tải lại trang", i: "fa-redo" }],
                c: 0
            },
            // CÂU 24 (Bỏ icon, sửa bim bim -> bánh)
            {
                q: "Câu 24: Em có nên vừa ăn bánh vừa gõ bàn phím không?",
                a: [{ t: "Có" }, { t: "Không (Dễ bẩn, hỏng máy)" }, { t: "Thỉnh thoảng" }],
                c: 1
            },
            // CÂU 25
            {
                q: "Câu 25: Khi tay ướt, em có được chạm vào ổ cắm điện máy tính không?",
                a: [{ t: "Tuyệt đối không", i: "fa-exclamation-triangle" }, { t: "Được", i: "fa-check" }, { t: "Chạm nhẹ thôi", i: "fa-hand-sparkles" }],
                c: 0
            },
            // CÂU 26
            {
                q: "Câu 26: Để máy tính bền đẹp, khi dùng xong em nên làm gì?",
                a: [{ t: "Rút dây điện ngay", i: "fa-plug" }, { t: "Tắt máy đúng cách (Shut down)", i: "fa-power-off" }, { t: "Để nguyên đó", i: "fa-clock" }],
                c: 1
            },
            // CÂU 27
            {
                q: "Câu 27: Máy in giúp em làm công việc gì?",
                a: [{ t: "In hình ảnh ra giấy", i: "fa-print" }, { t: "Chụp ảnh", i: "fa-camera" }, { t: "Quay phim", i: "fa-video" }],
                c: 0
            },
            // CÂU 28
            {
                q: "Câu 28: Thiết bị nào dùng để thu âm giọng nói của em?",
                a: [{ t: "Loa", i: "fa-volume-up" }, { t: "Micro", i: "fa-microphone" }, { t: "Màn hình", i: "fa-desktop" }],
                c: 1
            },
            // CÂU 29
            {
                q: "Câu 29: Nếu máy tính bị hỏng hoặc có khói, em nên làm gì?",
                a: [{ t: "Tự sửa", i: "fa-tools" }, { t: "Báo ngay cho người lớn", i: "fa-user-shield" }, { t: "Đổ nước vào", i: "fa-tint" }],
                c: 1
            },
            // CÂU 30
            {
                q: "Câu 30: Học Tin học giúp em điều gì?",
                a: [{ t: "Chỉ để chơi game", i: "fa-gamepad" }, { t: "Biết sử dụng máy tính hỗ trợ học tập", i: "fa-graduation-cap" }, { t: "Không giúp gì cả", i: "fa-times" }],
                c: 1
            }
        ];

        function startQuiz() {
            const name = document.getElementById('sName').value.trim();
            const cls = document.getElementById('sClass').value.trim();
            if(!name || !cls) { alert("Con nhớ nhờ ba mẹ điền tên và lớp nhé!"); return; }
            student.name = name; student.class = cls;
            document.getElementById('displayInfo').innerText = `${name} - Lớp ${cls}`;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainHeader').style.display = 'flex'; // Đổi từ block sang flex để hợp với header mới
            document.getElementById('mainFooter').style.display = 'block';
            document.getElementById('backButtonArea').style.display = 'block';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('footerBar').style.display = 'flex';
            renderQuiz();
        }

        function renderQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = "";
            questions.forEach((q, idx) => {
                let html = `
                <div class="question-card" id="card-${idx}">
                    <div class="q-header">
                        <div class="q-number">${idx + 1}</div>
                        <div class="q-text">${q.q}</div>
                    </div>
                    <div class="answers-grid">
                        ${q.a.map((opt, optIdx) => `
                            <label class="answer-opt" id="lbl-${idx}-${optIdx}">
                                <input type="radio" name="q${idx}" value="${optIdx}">
                                ${opt.i ? `<i class="fas ${opt.i} ans-icon"></i>` : ''} 
                                <span class="ans-text">${opt.t}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }

        async function submitExam() {
            let unanswered = [];
            questions.forEach((_, idx) => {
                const checked = document.querySelector(`input[name="q${idx}"]:checked`);
                const card = document.getElementById(`card-${idx}`);
                card.classList.remove('unanswered');
                if(!checked) { unanswered.push(idx); card.classList.add('unanswered'); }
            });

            if(unanswered.length > 0) {
                alert(`Con ơi, còn ${unanswered.length} câu chưa làm xong. Con kiểm tra các khung màu đỏ nhé!`);
                document.getElementById(`card-${unanswered[0]}`).scrollIntoView({behavior: "smooth", block: "center"});
                return;
            }

            if(!confirm("Con đã chắc chắn nộp bài chưa?")) return;

            let score = 0;
            questions.forEach((q, idx) => {
                const checked = document.querySelector(`input[name="q${idx}"]:checked`);
                const val = parseInt(checked.value);
                document.querySelectorAll(`input[name="q${idx}"]`).forEach(inp => inp.disabled = true);
                if(val === q.c) {
                    score++;
                    document.getElementById(`lbl-${idx}-${val}`).classList.add('correct');
                } else {
                    document.getElementById(`lbl-${idx}-${val}`).classList.add('wrong');
                    document.getElementById(`lbl-${idx}-${q.c}`).classList.add('correct');
                }
            });

            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('footerBar').style.display = 'none';
            
            const scoreText = `${score}/${questions.length}`;
            const pdfHeader = document.getElementById('pdf-header-info');
            pdfHeader.style.display = 'block';
            document.getElementById('pdf-name').innerText = `Họ tên: ${student.name} - Lớp: ${student.class}`;
            document.getElementById('pdf-score').innerText = `Điểm số: ${scoreText}`;

            const element = document.getElementById('pdf-area');
            const fileName = `BaiThi_${student.class}_${student.name}.pdf`;
            const opt = { margin: 5, filename: fileName, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 1.5, useCORS: true }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };

            try {
                const pdfData = await html2pdf().set(opt).from(element).outputPdf('datauristring');
                const base64Content = pdfData.split(',')[1];

                // Gửi dữ liệu lên Script
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Quan trọng: no-cors để tránh lỗi chặn của trình duyệt
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fileName: fileName,
                        fileData: base64Content
                    })
                });

                // Tải về máy
                await html2pdf().set(opt).from(element).save();
                document.getElementById('driveMsg').innerHTML = "<span style='color:green'>✔ Đã lưu gửi bài cho giáo viên thành công.</span>";
            } catch (err) {
                console.error(err);
                await html2pdf().set(opt).from(element).save();
                document.getElementById('driveMsg').innerHTML = "<span style='color:orange'>⚠ Đã tải về máy (Lỗi kết nối mạng).</span>";
            }

            document.getElementById('loadingOverlay').style.display = 'none';
            pdfHeader.style.display = 'none';
            document.getElementById('scoreDisplay').innerText = scoreText;
            document.getElementById('msg').innerText = score >= 25 ? "Con làm bài rất xuất sắc!" : "Con làm tốt lắm!";
            document.getElementById('resultModal').style.display = 'flex';
        }
    </script>
</body>
</html>
